(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();const g="modulepreload",w=function(a){return"/"+a},f={},m=function(t,e,s){let n=Promise.resolve();if(e&&e.length>0){const r=document.getElementsByTagName("link");n=Promise.all(e.map(o=>{if(o=w(o),o in f)return;f[o]=!0;const i=o.endsWith(".css"),l=i?'[rel="stylesheet"]':"";if(!!s)for(let d=r.length-1;d>=0;d--){const u=r[d];if(u.href===o&&(!i||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const c=document.createElement("link");if(c.rel=i?"stylesheet":g,i||(c.as="script",c.crossOrigin=""),c.href=o,document.head.appendChild(c),i)return new Promise((d,u)=>{c.addEventListener("load",d),c.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${o}`)))})}))}return n.then(()=>t()).catch(r=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=r,window.dispatchEvent(o),!o.defaultPrevented)throw r})};class y{constructor(t){this.kll=t,this.name=""}apply(){this.name&&typeof this.action=="function"?this.kll[this.name]=this.action.bind(this):console.warn(`action is not a function or name is not defined for plugin ${this.constructor.name}`)}action(){console.warn("the plugin action is not defined")}}class h{constructor(t){this.id=t.id,this.routes=t.routes,this.ctrlPath=t.ctrlPath||"./ctrl/",this.templatePath=t.templatePath||"./templates/",this.plugins={},(t.plugins||[]).forEach(s=>{if(s.prototype instanceof y){const n=new s(this);n.name?(this.plugins[n.name]=n.action,n.apply()):console.warn(`Plugin ${s.name} as no name.`)}else console.warn(`the plugin ${s.name} is not a KLLPlugin.`)}),this._init()}_init(){const t=document.getElementById(this.id);if(!t){console.warn(`No element found with id ${this.id}`);return}t.routes=this.routes,this.injectPage(window.location.pathname)}async injectPage(t){var n;const s=(n=document.querySelector("#app").routes[t])==null?void 0:n.default;if(s){const r=document.querySelector("#app");r.innerHTML=s,await this.kllT()}}static getState(t){const e=document.querySelector(`[kll-id='${t}']`);return(e==null?void 0:e.state)||{}}async hydrate(t){var o,i;this.cleanUpElement(t);const e=await this.processAttributes(t),s=document.createElement("div");s.appendChild(e.template);const n=s.firstElementChild;n._listeners={},n.state=this.handleInitState(e.state,n,(o=e.ctrl)==null?void 0:o.render);for(const l in e.attrs)n.setAttribute(l,e.attrs[l]);n.kllId=e.kllId||`${t.getAttribute("kll-t")}_${new Date().getTime()}`,this.handleAttachMethods(n,e.ctrl,n.state),n.getState=l=>h.getState(l);const r=n.querySelector("slot");if(r){const l=t.firstElementChild||t.firstChild;r.replaceWith(l)}t.replaceWith(n),(i=n==null?void 0:n.onInit)==null||i.call(n)}cleanUpElement(t){t!=null&&t._listeners&&(Object.keys(t._listeners).forEach(e=>{t.removeEventListener(e,t._listeners[e])}),t._listeners={})}async kllT(){const t=document.querySelectorAll("[kll-t]");for(const e of t)await this.hydrate(e)}cleanUpElement(t){t!=null&&t._listeners&&(Object.keys(t._listeners).forEach(e=>{t.removeEventListener(e,t._listeners[e])}),t._listeners={})}async kllT(){const t=document.querySelectorAll("[kll-t]");for(const e of t)await this.hydrate(e)}handleInitState(t,e,s){const n=s?this.getDependencies(s):null;return new Proxy(t,{set:(r,o,i)=>{const l=Reflect.set(r,o,i);return n&&n.has(o)&&e.render(o,i),this.handleTriggerState(o,i,e.kllId),l}})}async handleTriggerState(t,e,s){var r;const n=document.querySelectorAll(`[kll-b*='${s}.${t}']`);for(const o of n)(r=o==null?void 0:o.render)==null||r.call(o,{key:t,value:e,name:s})}getDependencies(t){const e=t.toString(),s=/\bstate\.(\w+)|\${state\.(\w+)}|\{(\w+)[^}]*\}\s*=\s*state/g;let n;const r=new Set;for(;(n=s.exec(e))!==null;)r.add(n[1]||n[2]||n[3]);return r}async processAttributes(t){const e={state:[],ctrl:{},template:{},attrs:{},kllId:null};for(const s of t.getAttributeNames()){const n=t.getAttribute(s);s.startsWith("kll-s")&&e.state.push({[s.slice(6)]:n}),s==="kll-ctrl"?e.ctrl=await this.handleControllerAttribute(n):s==="kll-t"?e.template=await this.handleTemplate(n):s==="kll-id"&&(e.kllId=n,e.attrs["kll-id"]=n),(!s.startsWith("kll-")||s==="kll-b")&&(e.attrs[s]=n)}return e.ctrl.state&&(e.state=[...Object.keys(e.ctrl.state).map(s=>({[s]:e.ctrl.state[s]})),...e.state]),e.state=e.state.reduce((s,n)=>({...s,...n}),{}),e}async handleTemplate(t){let e=null;try{const l=t.replace(".","/"),p=l.startsWith("/")?l.slice(1):l,c=`${this.templatePath}${p}.html?raw`;e=await m(()=>import(c),__vite__mapDeps([]))}catch{throw new Error(`Template ${t} not found`)}const s=document.createElement("div");s.innerHTML=e.default;const n=t.split(".").pop(),r=s.querySelector(`#${n}`).content,o=document.importNode(r,!0),i=document.createElement("div");return i.appendChild(o),i.firstElementChild}async handleControllerAttribute(t){let e=null;const s=t.split(".").pop();try{const n=t.replace(".","/"),r=n.startsWith("/")?n.slice(1):n,o=`${this.ctrlPath}${r}.js`;e=await m(()=>import(o),__vite__mapDeps([]))}catch{throw new Error(`Controller ${t} not found`)}if(!e.default&&!e[s])throw new Error(`Controller ${t} not found`);return e.default||e[s]}handleAttachMethods(t,e,s){const n=Object.keys(e).filter(r=>r.startsWith("on")).filter(r=>!r.match(/state|oninit/i));e.render&&(t.render=r=>e.render(s,t,r)),e.onInit&&(t.onInit=()=>e.onInit(s,t));for(const r of n){const o=r.slice(2).toLocaleLowerCase(),i=l=>{typeof e[r]=="function"?e[r](s,l.target,l):console.warn(`Method ${o} is not defined on the controller.`)};t._listeners[o]=i,t.addEventListener(o,i)}}registerPlugin(t,e){this.plugins[t]=e}}class k extends y{constructor(t){super(t),this.name="createComponent"}action(t,e,s,n={}){const r=document.createElement("div");r.setAttribute("kll-t",t),r.setAttribute("kll-ctrl",e),r.setAttribute("kll-id",s);for(const[o,i]of Object.entries(n))r.setAttribute(`kll-s-${o}`,i);return this.kll.hydrate(r),r}}const v=`<div>\r
  <h1>Hello KLL!</h1>\r
\r
  <div kll-t="button-count" kll-ctrl="buttonCount" kll-s-word="salut ceci vient d'une props" data-trans="test"\r
    kll-id="my_button"></div>\r
\r
  <div kll-t="text-to-render" kll-b="truc.rien,my_button.count" kll-ctrl="textToRender"></div>\r
\r
  <div kll-t="with-children">\r
    <div>hello, children</div>\r
  </div>\r
  <div kll-t="inception" kll-ctrl="inception" kll-b="inception_button.count"></div>\r
  <div kll-t="ui.button" kll-ctrl="ui.button">Button in folder "ui"</div>\r
</div>`,b=`<div>\r
    <h1>Home</h1>\r
    <p>Home page content</p>\r
</div>`;new h({id:"app",routes:{"/":v,"/home":b},ctrlPath:"/ctrl/",templatePath:"/templates/",plugins:[k]});
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}