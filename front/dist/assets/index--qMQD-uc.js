import{k as i}from"./index-8tF7nBJ4.js";import{l as C,r as R}from"./index-8tF7nBJ4.js";const E={onInit(e,t){t.render()},onclick(e,t){t.classList.contains("border-green-700")?(t.classList.remove("border-green-700"),t.classList.add("border-red-700")):(t.classList.remove("border-red-700"),t.classList.add("border-green-700"))},render(e,t){}},S={onClick(e,t,n){n.preventDefault();const r=t.getAttribute("href");window.history.pushState({},"",r),i.injectPage(r)}},f={onInit(e,t){t.render()},render(e,t){i.plugins.translate(t)}},v={onInit(e,t){t.render()},render(e,t){i.plugins.translate(t)}};let c;const b=new Uint8Array(16);function y(){if(!c&&(c=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!c))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return c(b)}const o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));function h(e,t=0){return o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]}const I=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),u={randomUUID:I};function _(e,t,n){if(u.randomUUID&&!t&&!e)return u.randomUUID();e=e||{};const r=e.random||(e.rng||y)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){n=n||0;for(let a=0;a<16;++a)t[n+a]=r[a];return t}return h(r)}const p="rc__userId";function w(){const e=localStorage.getItem(p);if(e)return e;const t=_();return localStorage.setItem(p,t),t}function x(){const{params:e}=i.parseRoute(),t={"x-user-id":w()};return e.editor&&(t["x-editor-id"]=e.broadcast),e.reader&&(t["x-reader-id"]=e.broadcast),{headers:t}}async function d(e,t,n,r){const a=x();return await fetch(n,{method:e,signal:t,body:r?JSON.stringify(r):void 0,...a})}const g={async get(e,t){return await d("GET",t,e)},async post(e,t,n){return await d("POST",t,e,n)},async put(e,t,n){return await d("PUT",t,e,n)},async delete(e,t){return await d("DELETE",t,e)}},D={state:{isInit:!1,controller:new AbortController,broadcast:[]},async onInit(e){if(e.isInit)return;const t=e.controller.signal;try{const r=await(await g.get("/api/broadcasts/last",t)).json();e.broadcast=r}catch(n){console.log(n)}finally{e.isInit=!0}},onClean(e){e.controller.abort()},render(e,t){e.isInit&&(e.broadcast.length?(t.innerHTML="",document.createElement("ul").classList.add("list-disc","list-inside"),e.broadcast.forEach(r=>{const a=document.createElement("li"),s=document.createElement("a");s.innerText=r.name,s.setAttribute("kll-ctrl","link"),s.setAttribute("kll-id",r.editor),s.setAttribute("href",`/bc/editor/${r.editor}`),s.setAttribute("alt",r.name),a.classList.add("text-xs"),i.hydrate(s),a.appendChild(s),t.appendChild(a)})):(t.setAttribute("data-trans","no_broadcast_history"),t.classList.add("italic","text-xs"),i.plugins.translate(t)))}},L={state:{error:"",controller:new AbortController},onInit(e,t){i.plugins.translate(t),t.render()},async onSubmit(e,t,n){n.preventDefault();const r=new FormData(t),a=Object.fromEntries(r.entries());try{const s=await g.post("/api/broadcast",e.controller.signal,a);if(s.status!==201){e.error="error_create_broadcast";return}const{editor:m}=await s.json(),l=`/bc/editor/${m}`;window.history.pushState(null,null,l),i.injectPage(l)}catch(s){console.log("broadcast creation: ",s),e.error="error_create_broadcast"}},onClean(e){e.controller.abort()},render(){}},k={render(e,t,n){if(!n.key)return;const{value:r}=n;t.innerText!==r&&t.setAttribute("data-trans",r),i.plugins.translate(t)}},A={state:{value:"",error:""},onInput(e,t,n){e.value=n.target.value,e.error=""},render(){}};export{E as button,L as createBroadcastForm,k as errorMsg,v as header,A as input,D as lastBroadcast,S as link,C as lsKEY,R as rupteur,f as translate};
